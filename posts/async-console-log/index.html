<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="twitter:creator" content="@max_kim_dev" data-gatsby-head="true"/><meta name="twitter:image" content="https://maxkim-j.github.io/thumbnail.png" data-gatsby-head="true"/><meta name="twitter:description" content="어떤 log가 먼저 찍힐까?" data-gatsby-head="true"/><meta name="twitter:title" content="김맥스 블로그 | console.log 문제 풀이 - 마이크로태스크 큐" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="image" content="https://maxkim-j.github.io/thumbnail.png" data-gatsby-head="true"/><meta name="description" content="어떤 log가 먼저 찍힐까?" data-gatsby-head="true"/><meta name="generator" content="Gatsby 4.19.2"/><style data-href="/styles.10c8c1ffada55909c622.css" data-identity="gatsby-global-css">@font-face{font-family:Pretendard;font-style:normal;font-weight:500;src:url(/static/Pretendard-Regular-6090e6b5524796768e78f23519d16488.woff2) format("woff2")}@font-face{font-family:Pretendard;font-style:normal;font-weight:600;src:url(/static/Pretendard-SemiBold-7e5eaaf650b9e738991373a7f173b94a.woff2) format("woff2")}body[data-theme=light] *{color:#000}body[data-theme=light] p{color:"$black"}body[data-theme=light] p>code{background-color:#efefef}body[data-theme=light] deckgo-highlight-code{--deckgo-highlight-code-carbon-background:#f5f5f5;--deckgo-highlight-code-carbon-color:#202020;--deckgo-highlight-code-token-atrule:#a626a4;--deckgo-highlight-code-token-comment:#65737e;--deckgo-highlight-code-token-comment-rgb:#65737e;--deckgo-highlight-code-token-function:#ac4142;--deckgo-highlight-code-token-operator:#202020;--deckgo-highlight-code-token-property:#ac4142;--deckgo-highlight-code-token-punctuation:#202020;--deckgo-highlight-code-token-regex:#f4bf75;--deckgo-highlight-code-token-selector:#90a959}body[data-theme=dark] *{background-color:#232323;color:#fff}body[data-theme=dark] a,body[data-theme=dark] a:link,body[data-theme=dark] a:visited{color:#fff}body[data-theme=dark] blockquote{border-left:3px solid #fff}body[data-theme=dark] p>code{background-color:#6b6b6b}body[data-theme=dark] p{color:#fff}body[data-theme=dark] input[type=range]{background-color:#fff}body[data-theme=dark] input[type=range]::-webkit-slider-thumb{background-color:#fff}body[data-theme=dark] deckgo-highlight-code{--deckgo-highlight-code-carbon-background:#2b2b2b;--deckgo-highlight-code-carbon-color:#f8f8f2;--deckgo-highlight-code-token-atrule:#ffa07a;--deckgo-highlight-code-token-comment:#606060;--deckgo-highlight-code-token-comment-rgb:#d4d0ab;--deckgo-highlight-code-token-function:#00e0e0;--deckgo-highlight-code-token-operator:#abe338;--deckgo-highlight-code-token-property:#00e0e0;--deckgo-highlight-code-token-punctuation:gold;--deckgo-highlight-code-token-regex:#f8f8f2;--deckgo-highlight-code-token-selector:#f8f8f2;background-color:#2b2b2b!important}body[data-theme=mincho] *{background-color:#2f201b;color:#b0e8f7}body[data-theme=mincho] a,body[data-theme=mincho] a:link,body[data-theme=mincho] a:visited,body[data-theme=mincho] p{color:#b0e8f7}body[data-theme=mincho] p>code{background-color:#5e4138}body[data-theme=mincho] input[type=range]{background-color:#b0e8f7}body[data-theme=mincho] input[type=range]::-webkit-slider-thumb{background-color:#b0e8f7}body[data-theme=mincho] blockquote{border-left:3px solid #b0e8f7}body[data-theme=mincho] deckgo-highlight-code{--deckgo-highlight-code-carbon-background:#2b2b2b;--deckgo-highlight-code-carbon-color:#f8f8f2;--deckgo-highlight-code-token-atrule:#ffa07a;--deckgo-highlight-code-token-comment:#606060;--deckgo-highlight-code-token-comment-rgb:#d4d0ab;--deckgo-highlight-code-token-function:#00e0e0;--deckgo-highlight-code-token-operator:#abe338;--deckgo-highlight-code-token-property:#00e0e0;--deckgo-highlight-code-token-punctuation:gold;--deckgo-highlight-code-token-regex:#f8f8f2;--deckgo-highlight-code-token-selector:#f8f8f2;background-color:#042924!important}body[data-theme=lemon] *{background-color:#340e39;color:#d1ce4c}body[data-theme=lemon] a,body[data-theme=lemon] a:link,body[data-theme=lemon] a:visited{color:#d1ce4c}body[data-theme=lemon] blockquote{border-left:3px solid #d1ce4c}body[data-theme=lemon] p{color:#d1ce4c}body[data-theme=lemon] p>code{background-color:#7b3c83}body[data-theme=lemon] input[type=range]{background-color:#d1ce4c}body[data-theme=lemon] input[type=range]::-webkit-slider-thumb{background-color:#d1ce4c}body[data-theme=lemon] deckgo-highlight-code{--deckgo-highlight-code-carbon-background:#2b2b2b;--deckgo-highlight-code-carbon-color:#f8f8f2;--deckgo-highlight-code-token-atrule:#ffa07a;--deckgo-highlight-code-token-comment:#606060;--deckgo-highlight-code-token-comment-rgb:#d4d0ab;--deckgo-highlight-code-token-function:#00e0e0;--deckgo-highlight-code-token-operator:#abe338;--deckgo-highlight-code-token-property:#00e0e0;--deckgo-highlight-code-token-punctuation:gold;--deckgo-highlight-code-token-regex:#f8f8f2;--deckgo-highlight-code-token-selector:#f8f8f2;background-color:#2e042d!important}</style><title data-gatsby-head="true">김맥스 블로그 | console.log 문제 풀이 - 마이크로태스크 큐</title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style id="stitches">--sxs{--sxs:0 t-ihqjpx}@media{:root,.t-ihqjpx{--fonts-system:system-ui;--colors-black:#000000;--colors-dark:#232323;--colors-white:#ffffff;--colors-orange:#ffb566;--colors-turquoise:#8cffd6;--colors-pink:#ffa5e4;--fontSizes-mainTitle:30px;--fontSizes-title:28px;--fontSizes-subTitle:24px;--fontSizes-mobileTitle:20px;--fontSizes-description:14px;--fontSizes-mobileDescription:10px;--fontSizes-heading1:32px;--fontSizes-heading2:28px;--fontSizes-heading3:24px;--fontSizes-heading4:20px;--fontSizes-body1:18px;--fontSizes-body2:16px;--fontSizes-body3:14px;--fontSizes-body4:12px;--fontWeights-extraBold:700;--fontWeights-bold:600;--fontWeights-regular:500;--fontWeights-thin:300}}--sxs{--sxs:1 gXKzTB fzBkpa}@media{*{font-family:Pretendard}p,body{margin:0;padding:0;font-size:var(--fontSizes-body1)}strong{font-weight:var(--fontWeights-bold)}a{text-decoration:none}a:link{color:var(--colors-black)}a:visited{color:var(--colors-black)}img{width:100%;height:auto}ol{list-style-type:none;margin-block-start:0;margin-block-end:0;margin-inline-start:0;margin-inline-end:0;padding-inline-start:0}h1{font-size:var(--fontSizes-heading1);font-weight:var(--fontWeights-bold)}h2{font-size:var(--fontSizes-heading2);font-weight:var(--fontWeights-bold)}h3{font-size:var(--fontSizes-heading3);font-weight:var(--fontWeights-bold)}h4{font-size:var(--fontSizes-heading4);font-weight:var(--fontWeights-bold)}h5{font-size:var(--fontSizes-heading5);font-weight:var(--fontWeights-bold)}p{margin-bottom:24px;word-wrap:break-word;line-height:1.6;word-break:all}h1{margin-top:48px;margin-bottom:36px}h2{margin:32px 0}h3{margin:28px 0}h4{margin:24px 0}h5{margin:20px 0}p a{text-decoration:underline;text-underline-position:under}p > code{padding:2px 8px;border-radius:8px;font-size:16px}@media (max-width: 730px){p > code{font-size:14px}}blockquote{border-left:3px solid var(--colors-black);padding-left:10px;margin:20px 0;font-style:italic}@media (max-width: 730px){deckgo-highlight-code{font-size:var(--fontSizes-body2)}}deckgo-highlight-code{--deckgo-highlight-code-white-space:pre;--deckgo-highlight-code-margin:12px 0 16px 0;--deckgo-highlight-code-scroll:none;--deckgo-highlight-code-carbon-margin:28px 0;--deckgo-highlight-code-carbon-box-shadow:none}li{line-height:1.8}li > a{text-decoration:underline;text-underline-position:under}}--sxs{--sxs:2 c-llJfQk c-dVNheE c-bkUmzp c-PJLV c-jMkcPK c-kdYLWQ c-iEaapN c-enMnGJ c-jPqceB c-feMWly c-gHothk c-kcUpuv c-zOevm c-iDjjYv c-inPSka c-hLbyMm c-kINvOu c-inYmSa c-gAHJmZ c-eqDGAL c-kxdqJo c-fVALJv}@media{.c-llJfQk{width:100vw;min-height:100vh;display:flex;justify-content:center}.c-dVNheE{padding:24px 18px 0px 18px;box-sizing:border-box;width:920px}@media (max-width: 730px){.c-dVNheE{width:100%}}@media (max-width: 730px){.c-dVNheE p,.c-dVNheE ul,.c-dVNheE li{font-size:var(--fontSizes-body2)}}@media (max-width: 730px){.c-dVNheE h1{font-size:var(--fontSizes-heading2)}}@media (max-width: 730px){.c-dVNheE h2{font-size:var(--fontSizes-heading3)}}@media (max-width: 730px){.c-dVNheE h3{font-size:var(--fontSizes-heading4)}}@media (max-width: 730px){.c-dVNheE h4{font-size:body1}}.c-bkUmzp{display:flex;justify-content:space-between;margin-bottom:82px}.c-jMkcPK{font-size:var(--fontSizes-mainTitle);font-weight:var(--fontWeights-bold)}@media (max-width: 730px){.c-jMkcPK{font-size:var(--fontSizes-subTitle)}}.c-kdYLWQ{display:flex;align-items:center}.c-kdYLWQ >div{margin-left:25px}@media (max-width: 730px){.c-kdYLWQ{font-size:var(--fontSizes-body3)}}.c-iEaapN{position:relative;cursor:pointer}.c-enMnGJ{min-height:700px}.c-jPqceB{margin-top:32px;display:flex;height:32px;align-items:center;justify-content:space-between;bottom:0;z-index:10}.c-jPqceB div{font-size:10px}.c-jPqceB a{text-decoration:underline;font-size:10px}@media (max-width: 730px){.c-jPqceB{font-size:var(--fontSizes-mobileDescription)}}.c-feMWly ol{list-style-type:decimal;margin-block-start:1em;margin-block-end:1em;margin-inline-start:2em}.c-gHothk{margin-bottom:60px}.c-kcUpuv{margin:28px 0}.c-zOevm{font-size:var(--fontSizes-body2);margin-bottom:6px}.c-iDjjYv{font-size:var(--fontSizes-description)}.c-inPSka{width:100%;background-color:var(--colors-black);height:1px;margin:50px 0}.c-hLbyMm{display:flex;justify-content:space-between;font-size:var(--fontSizes-description)}.c-kINvOu{display:flex;justify-content:space-between}.c-kINvOu a{margin-left:20px}.c-kINvOu a:hover{text-decoration:underline;text-underline-position:under}.c-inYmSa{margin-top:20px;display:flex;font-size:var(--fontSizes-description)}.c-inYmSa div{margin-right:18px}.c-inYmSa div:hover{text-decoration:underline;text-underline-position:under}.c-inYmSa div{cursor:pointer}.c-gAHJmZ{margin:20px 0 60px 0;display:flex;justify-content:space-between;font-size:var(--fontSizes-description)}.c-gAHJmZ a:hover{text-decoration:underline;text-underline-position:under}.c-eqDGAL a{margin-left:20px}.c-kxdqJo .utterances{max-width:none}.c-kxdqJo iframe main.timeline{padding:0}.c-fVALJv{font-size:var(--fontSizes-description);margin-right:12px;text-decoration:underline}}</style></head><body><script>
    const savedTheme = localStorage.getItem('maxkim-blog-theme');
    const theme = savedTheme || 'light';
    
    window.__theme = theme;
    window.__setTheme = (newTheme) => {
      document.body.setAttribute("data-theme", newTheme);
      localStorage.setItem('maxkim-blog-theme', newTheme);
    };

    window.__setTheme(theme);
  </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="c-llJfQk"><div class="c-dVNheE"><header><div class="c-bkUmzp"><div class="c-PJLV"><a href="/"><div class="c-jMkcPK">김맥스 블로그</div></a></div><div class="c-kdYLWQ"><div class="c-iEaapN"><div><div>color</div></div></div><div><a href="/gallery">gallery</a></div><div><a href="/about">about</a></div></div></div></header><main class="c-enMnGJ"><div class="c-gHothk"><h1 class="c-kcUpuv">console.log 문제 풀이 - 마이크로태스크 큐</h1><div class="c-zOevm">어떤 log가 먼저 찍힐까?</div><div class="c-iDjjYv"><a class="c-fVALJv" href="/tags/?tag=javascript">#<!-- -->javascript</a></div></div><div class="c-feMWly"><p>이번 여름 구직 면접에서 콘솔로그 순서 문제 몇 개를 마주쳤습니다. <code>.js</code>파일 하나를 주고 실행시키면 어떤 것부터 출력되냐는 문제였는데요. 이벤트 루프와 비동기 프로그래밍이 무엇인지를 이해하면 쉽게 풀 수 있는 문제부터, 거기서 약간 더 나아간 내용을 물어보는 문제도 있었어요.</p><p>이번 포스팅에서는 기술면접 콘솔로그 문제들이 물어봤었던 비동기 프로그래밍의 개념 중, 지엽적이지 않고 실제 프로그래밍에 도움이 될 수 있을만한 개념들을 골라 정리해보려고 합니다.</p><h2 id="선행-지식" style="position:relative"><a href="#%EC%84%A0%ED%96%89-%EC%A7%80%EC%8B%9D" aria-label="선행 지식 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>선행 지식</h2><p>이 포스팅은  아래와 같은 JS 비동기 프로그래밍에 대한 지식에 무언가 더 <strong>얹는다</strong>는 느낌으로 보셨으면 합니다.</p><ul><li>이벤트 루프</li><li>비동기 로직 처리 순서</li><li>실행 컨텍스트</li><li>Promise</li><li>Async/Await</li></ul><h2 id="문제-풀어보기---비동기-피카츄" style="position:relative"><a href="#%EB%AC%B8%EC%A0%9C-%ED%92%80%EC%96%B4%EB%B3%B4%EA%B8%B0---%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%94%BC%EC%B9%B4%EC%B8%84" aria-label="문제 풀어보기   비동기 피카츄 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>문제 풀어보기 - 비동기 피카츄</h2><p>이 문제의 핵심은 <strong>같은 비동기 로직이라도 처리 우선순위가 다를 수 있다는 점</strong>입니다. 이벤트 루프에는 일반적인 태스크 큐와 더불어 <strong>마이크로태스크 큐</strong>라는 개념이 존재합니다. 마이크로태스크 큐의 콜백이 모두 이행되어 큐가 비어있어야만 태스크 큐의 콜백들이 실행될 수 있습니다. axios와 <a href="https://pokeapi.co/">PokéApi</a>를 사용해 피카츄가 전투(?)에 임하는 상황을 바탕으로 간단한 문제를 만들어 봤습니다.</p><deckgo-highlight-code language="javascript" theme="a11y-dark">
          <code slot="code">// pikachu.js
async function comeOutPikachu() {
  // 1
  setTimeout(() =&gt; {
    console.log(`피카츄가 ${selectedBerry}열매로 ${amount}만큼의 체력을 회복했다!`);
  }, 2000);

  // 2
  let amount = 0;
  let selectedBerry = &#x27;&#x27;;

  // 3
  axios.get(&#x27;https://pokeapi.co/api/v2/berry/1/&#x27;).then((berry) =&gt; {
    setTimeout(() =&gt; {
      console.log(`http 통신을 통해 ${berry.data.name}열매가 도착했다!`);
      selectedBerry = berry.data.name;
    }, 1000);
  });

  // 4
  axios.get(&#x27;https://pokeapi.co/api/v2/berry/25/&#x27;).then((berry) =&gt; {
    console.log(`http 통신을 통해 ${berry.data.name}열매가 도착했다!`);
    selectedBerry = berry.data.name;
  });

  // 5
  for (let i = 0; i &lt; 50; i++) {
    amount += 1;
  }

  // 6
  new Promise((resolve, reject) =&gt; {
    resolve(&#x27;피카츄 백만볼트&#x27;);
  }).then((data) =&gt; {
    setTimeout(() =&gt; console.log(`피카~~~츄~~~~~~~~~~~`));
    setTimeout(() =&gt; console.log(`피카츄 백만볼트의 효과는 강력했다!`), 5000);
    console.log(data);
  });

  // 7
  const otherPromise = await new Promise((resolve, reject) =&gt; {
    resolve(&#x27;피카츄 전광석화&#x27;);
  });

  // 8
  console.log(otherPromise);

  // 9
  setTimeout(() =&gt; console.log(&#x27;피카츄 귀여워&#x27;));

  // 10
  Promise.resolve(&#x27;피카츄 몸통박치기&#x27;).then((data) =&gt; console.log(data));
}

comeOutPikachu();</code>
        </deckgo-highlight-code><p>대충 예제는 피카츄가 여러 기술을 쓰다가 무려 http 통신으로 전달받은 나무열매를 통해 체력을 회복하는 내용으로 이루어져 있습니다. 출력되는 콘솔로그의 순서가 파악이 되시나요?</p><p>헷갈립니다. 동기 로직과 비동기 로직이 섞여있고, then 콜백에도 setTimeout이 들어가 있고, resolve가 사용된 즉시 이행 Promise나 시간 인자가 없는 setTimeout도 있습니다. 정확하게 출력 순서를 구분하기 위해서는 3가지의 구분을 더 해야합니다.</p><blockquote><p>공식적으로 모든 자바스크립트 실행문들의 동작이 이렇게 구분되는 것은 아닙니다. 문제풀이를 위한 실용적인 접근이라고 생각하시면 좋겠습니다.</p></blockquote><p>결론부터 말하자면, 요 블럭들은 크게 <code>동기 =&gt; 완결 비동기 마이크로태스크 =&gt; 완결 비동기 태스크 =&gt; 미완결 비동기 태스크/마이크로태스크</code> 이 순서대로 동작할 것입니다.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:800px">
      <a class="gatsby-resp-image-link" href="/static/59c456c05c87f77500f22b103b0ae801/5a190/async.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:50%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVQoz4WSSY6FMAxE//2PgYTYcAIWIMQMC+ZZDGK6hltlKSiNuj8LK0mZPJcdPud5EuI4DhL767o4xPmpP3Py3Y8s7PtOy7LQPM8c27bd2rquNE0TB3I4Q8c3MuMXEMkkSUhVVYrj+IY3TUPDMJBpmqQoClmWRV3XUdu2XACO/wQCgMtFUfCKj6GVZUlVVVGWZZSmKecR0F+BqNr3/V0drcGRYRik6zrlec7uNU0j27Y5/2/LAoh24BDtAgpAFEUUhiE7xFiwhz6O47vDJxAw13XJ930GBkFAjuMwFLN9naEAilfFrABBu9hjfp7n8Vy/OsQ8AMMMscKhXATusRdd1HX9/VGwPkPo+B9lXT7Lj/IDjpHJcc6Cw/MAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="async" title="async" src="/static/59c456c05c87f77500f22b103b0ae801/5a190/async.png" srcSet="/static/59c456c05c87f77500f22b103b0ae801/5a46d/async.png 300w,/static/59c456c05c87f77500f22b103b0ae801/0a47e/async.png 600w,/static/59c456c05c87f77500f22b103b0ae801/5a190/async.png 800w" sizes="(max-width: 800px) 100vw, 800px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
  </a>
    </span></p><h3 id="1-비동기동기-구분" style="position:relative"><a href="#1-%EB%B9%84%EB%8F%99%EA%B8%B0%EB%8F%99%EA%B8%B0-%EA%B5%AC%EB%B6%84" aria-label="1 비동기동기 구분 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 비동기/동기 구분</h3><p>기본입니다. 출력되는 순서를 제대로 파악하려면, 큰 블록(<code>{}</code>)들을 기준으로 일단 동기 로직과 비동기 로직을 구분할 수 있을 것 같습니다. 동기 로직은 비동기 로직에 항상 앞서 처리되기 때문이죠.</p><blockquote><p><strong>point : 동기 로직 처리가 비동기 로직에 선행함</strong></p></blockquote><ul><li>동기 로직 : 변수 선언(2), for문(5)</li><li>비동기 로직 : Promise가 이행되면 처리되는 then 내부의 콜백(3,4,6,10), Await(7), Await의 에 의존하는 console.log(8), setTimeout(1, 9)</li></ul><h3 id="2-완결미완결-구분" style="position:relative"><a href="#2-%EC%99%84%EA%B2%B0%EB%AF%B8%EC%99%84%EA%B2%B0-%EA%B5%AC%EB%B6%84" aria-label="2 완결미완결 구분 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 완결/미완결 구분</h3><p>하지만 이 구분만으로는 출력 순서를 정확히 구분할 수 없습니다. 비동기 로직들이 코딩된 순서대로 실행되는게 아니기 때문이죠. 그 다음으로는 비동기 로직들의 완결(complete) 여부를 파악해야 합니다.</p><p>Promise는 이행(resolve)과 거부(reject)개념이 있죠. 둘 중 뭐 하나라도 되면 완결인겁니다. 대기(pending)만 아니면 됩니다. Promise가 완결될 때 비동기적으로 then 메소드의 콜백이 호출됩니다. setTimeout의 경우에는 콜백과 함께 인자로 넘긴 시간이 지났을 때가 완결 시점입니다. 완결 시점이 되면 비동기적으로 콜백이 호출되죠.</p><p>Promise 객체가 만들어짐과 동시에 resolve, reject로 인해 완결되었거나, setTimeOut의 시간 인자가 없거나 0일때는 콜스택에 들어간 즉시 완결된 상태라고 볼 수 있습니다. 바로 연결된 콜백이 호출되죠.</p><p>하지만 axios 비동기 요청은 언제 완결이 될지 정확하게 파악할 수 없고, 시간인자가 존재하는 setTimeOut역시 선행되는 태스크 큐, 콜스택의 태스크 처리가 다 끝나야만 콜백이 호출되기 때문에 정확히 어떤 시점에 콜백이 호출되는지 알 수 없습니다.</p><p>더불어, 무조건 마이크로태스크인 미완결 비동기 로직의 promise가 setTimeOut보다 먼저 처리된다고 말할 수 없습니다. promise가 이행이 오래 걸려서 마이크로태스크 큐가 다 비워져있을때, setTimeOut이 먼저 처리될 수도 있습니다.</p><p>다만 이 문제에 한해서는, http요청이 빠르게 처리되고 있다는 것을 눈으로 확인했다면 2초, 5초의 시간 인자가 있는 setTimeOut이 좀 더 늦게 처리될 것이라 유추할 수 있을 것입니다.</p><blockquote><p><strong>point : 즉시 완결 비동기 로직이 미완결 비동기 로직에 선행하고, 비동기 로직 간의 순서는 정확히 알 수 없음</strong></p></blockquote><ul><li>즉시 완결 : resolve된 프로미스(6,7,10), resolve 프로미스에 의존하는 console.log(8), 시간 인자가 없는 setTimeOut(9)</li><li>미완결 : axios(3, 4), 시간 인자가 있는 setTimeOut(1)</li></ul><h3 id="3-마이크로태스크태스크-구분" style="position:relative"><a href="#3-%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%ED%83%9C%EC%8A%A4%ED%81%AC%ED%83%9C%EC%8A%A4%ED%81%AC-%EA%B5%AC%EB%B6%84" aria-label="3 마이크로태스크태스크 구분 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. 마이크로태스크/태스크 구분</h3><p>아직 끝이 아닙니다. 마이크로태스크인지, 그냥 태스크인지를 구분해야 즉시 완결 비동기 로직들의 실행 순서를 정확히 파악할 수 있습니다. 마이크로태스크는 일반 태스크보다 더 높은 우선순위를 갖는 태스크라고 할 수 있습니다. 태스크 중에 대기중인 태스크가 있더라도, 마이크로 태스크가 먼저 실행됩니다. 문제에서는 <code>Promise의 콜백</code>은 마이크  로태스크에 속하고, <code>setTimeOut의 콜백</code>은 태스크에 속합니다.</p><p>왜 이렇게 구분한 것일까요. <a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">이 포스팅</a>에 따르면 태스크 스케쥴링은 자바스크립트, DOM과 관련된 동작들이 순차적으로 실행될 수 있도록 스케쥴되는데 목적이 있고, 마이크로태스크 스케쥴링은 지금 실행되는 동작의 <strong>바로 뒤에</strong> 실행될 수 있도록 하는데 목적이 있다고 합니다. 우선순위가 높은 겁니다.</p><p>여기서부터는 제 생각입니다. DOM 이벤트 핸들링이나 정해진 작업을 일정 시간 후에 실행하는 setTimeOut보다, http통신 등 비동기 동작의 결과로 콜백에서 스크립트에 직접적으로 변화를 줄 가능성이 높은 로직들이 우선순위가 높은 마이크로태스크에 알맞지 않나 싶습니다. 그래서 Promise가 마이크로태스크로 분류되는 것이 아닌가,, 생각했습니다.</p><blockquote><p><strong>point : 마이크로태스크가 태스크에 선행함</strong></p></blockquote><ul><li>마이크로태스크: Promise(6,7,8,10)</li><li>태스크: setTimeOut(9)</li></ul><h3 id="4-콜백-안의-비동기-로직들" style="position:relative"><a href="#4-%EC%BD%9C%EB%B0%B1-%EC%95%88%EC%9D%98-%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%A1%9C%EC%A7%81%EB%93%A4" aria-label="4 콜백 안의 비동기 로직들 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. 콜백 안의 비동기 로직들</h3><p>3번, 6 번 프로미스의 then메소드 안에는 또 비동기 로직이 있죠. 다시 한번 볼까요?</p><deckgo-highlight-code language="javascript" theme="a11y-dark">
          <code slot="code">// pikachu.js

// 3
axios.get(&#x27;https://pokeapi.co/api/v2/berry/1/&#x27;).then((berry) =&gt; {
  setTimeout(() =&gt; {
    console.log(`http 통신을 통해 ${berry.data.name}열매가 도착했다!`);
    berry = berry.data.name;
  }, 1000);
});

// 6
new Promise((resolve, reject) =&gt; {
  resolve(&#x27;피카츄 백만볼트&#x27;);
}).then((data) =&gt; {
  setTimeout(() =&gt; console.log(`피카~~~츄~~~~~~~~~~~`));
  setTimeout(() =&gt; console.log(`피카츄 백만볼트의 효과는 강력했다!`), 5000);
  console.log(data);
});</code>
        </deckgo-highlight-code><p>이게 좀 헷갈리는 포인트인데, 블럭 안에서도 크게는 위에서 설명했던 것과 같은 흐름으로 동작합니다. 6번같은 경우는 promise가 즉시 완결되어 바로 콜백이 호출됩니다. 이때 완결된 setTimeOut과 미완결된 setTimeOut을 만나는데요. 이 setTimeOut들은 완결 조건이 완성된 콜백부터 태스크 큐에 들어갔다가, 블럭 바깥의 마이크로태스크들이 모두 종료된 뒤 그때 실행됩니다. 그래서 결국 동기 로직인 console.log만 먼저 실행되고 setTimeOut들은 나중에 처리됩니다.</p><p>그리고 또 하나의 팁이라면, 같은 실행 컨텍스트에 있는 실행문들 중에 비동기 로직이 있다면 그 비동기 로직의 콜백은 <strong>훨훨 날아간다</strong>라고 생각하면 좋을 것 같아요. 비동기 로직에 연결된 콜백의 실행 여부는 더 이상 그 실행 컨텍스트가 관장하지 않습니다. 어떠한 조건이 완성되었을 때 이벤트 루프가 실행시킵니다.</p><p>3번은 http요청이 완료되었을때 프로미스가 이행됩니다. 그 이후에 setTimeOut으로 미완결 비동기 처리를 하나 더 수행하죠. 여기 setTimeOut의 콜백은 마이크로태스크 가 모두 처리된 시점에 호출되겠지만, 시간 인자가 있어 미완결이기 때문에 정확한 시점은 파악할 수 없습니다.</p><h2 id="정답" style="position:relative"><a href="#%EC%A0%95%EB%8B%B5" aria-label="정답 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>정답</h2><p>그래서 정답은 다음과 같습니다. 피카츄가 공격을 하고 열매로 체력을 회복한 후 효과가 강력했더라...는 이야기입니다.</p><deckgo-highlight-code language="shell" theme="a11y-dark">
          <code slot="code">피카츄 백만볼트 # 6번
피카츄 전광석화 # 7번
피카츄 몸통박치기 # 10번
피카~~~츄~~~~~~~~~~~ # 6번 promise의 then 내부 콜백(즉시완결 setTimeOut)
피카츄 귀여워 # 9번
http 통신을 통해 grepa열매가 도착했다! # 4번
http 통신을 통해 cheri열매가 도착했다! # 3번
피카츄가 cheri열매로 50만큼의 체력을 회복했다! # 1번
피카츄 백만볼트의 효과는 강력했다! # 6번 promise의 then 내부 콜백(미완결 setTimeOut)</code>
        </deckgo-highlight-code><p>위에서 설명했던 처리 우선순위로 설명하면 다음과 같이 출력이 된 것입니다.</p><deckgo-highlight-code language="shell" theme="a11y-dark">
          <code slot="code"># 동기 - for문, amount가 50이 됨

# 즉시 완결 비동기 마이크로태스크(Promise)
피카츄 백만볼트
피카츄 전광석화
피카츄 몸통박치기

# 즉시 완결 비동기 태스크(setTimeOut(fn,0))
피카~~~츄~~~~~~~~~~~
피카츄 귀여워

# 미완결 비동  기
http 통신을 통해 grepa열매가 도착했다!
http 통신을 통해 cheri열매가 도착했다!
피카츄가 cheri열매로 50만큼의 체력을 회복했다!
피카츄 백만볼트의 효과는 강력했다!</code>
        </deckgo-highlight-code><p>즉시 완결되지 않은 비동기 로직의 경우, 어떤 로직이 먼저 처리되느냐에 따라 순서가 바뀔 수 있습니다만 여기에서는 대체적으로 http통신이 2초, 5초라는 시간 인자를 가진 setTimeOut보다 빠르게 처리되는 양상을 띄고 있습니다. 물론 2개의 http통신 중 어떤 것이 먼저 처리될지는 정확하게 말할 수 없겠죠. 여러번 실행해보면 다음과 같은 결과도 볼 수 있습니다.</p><deckgo-highlight-code language="shell" theme="a11y-dark">
          <code slot="code"># cheri가 grepa보다 먼저 처리되기도 합니다.

http 통신을 통해 cheri열매가 도착했다!
http 통신을 통해 grepa열매가 도착했다!
피카츄가 cheri열매로 50만큼의 체력을 회복했다!
피카츄 백만볼트의 효과는 강력했다!</code>
        </deckgo-highlight-code><p>지금까지 복잡한 console.log 문제를 풀어봤습니다. 어떠셨나요?! 이해를 전제하고 설명을 이어가다 보니 너무 친절하지는 못한 글 같다는 생각이 들어 조금 아쉽습니다,,ㅜㅜ 이벤트 루프의 심화 개념을 더 익히고 싶으신 분들은 아래 reference란을 참고해 주시면 좋을 것 같아요. 아무쪼록 이 포스팅을 통해 비동기 처리의 우선순위에 대해서 더 잘 알 수 있는 계기가 되셨음 좋겠습니다..!</p><h2 id="reference" style="position:relative"><a href="#reference" aria-label="reference permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reference</h2><ul><li><a href="https://ui.toast.com/weekly-pick/ko_20160617/">자바스크립트와 이벤트 루프</a></li><li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">Tasks, microtasks, queues and schedule</a></li><li><a href="https://ko.javascript.info/event-loop">이벤트 루프와 매크로, 마이크로태스크</a></li></ul></div><div><div class="c-inPSka"></div><div class="c-hLbyMm"><div>Written by 김맥스</div><div class="c-kINvOu"><a href="https://twitter.com/max_kim_dev">twitter</a><a href="https://github.com/MaxKim-J">github</a><a href="https://www.linkedin.com/in/%EC%A2%85%ED%98%81-%EA%B9%80-903967177/">linkedin</a></div></div><div class="c-inYmSa"><div>트위터에 공유하기</div><div>링크 복사하기</div></div><div class="c-gAHJmZ"><a href="/">글 목록으로 돌아가기</a><div class="c-eqDGAL"><a href="/posts/nuxt-ssr">이전글</a><a href="/posts/thought-ts">다음글</a><a href="/posts/react-component-this">랜덤</a></div></div><div class="c-kxdqJo"></div></div></main><footer><div class="c-jPqceB"><div>김맥스 블로그ⓒ김종혁, 2022</div><div>Powered By <a href="https://www.gatsbyjs.com/">gatsby</a> /<a href="">gh-pages</a></div></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-132859535-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/async-console-log/";window.___webpackCompilationHash="4a53cd9132f76a934f57";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f012ba4a76c3d692158a.js"],"app":["/app-9537a4856cd0b2a1dd44.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-1e045652be0e760ada58.js"],"component---src-pages-about-index-tsx":["/component---src-pages-about-index-tsx-31a350511f2323de75b8.js"],"component---src-pages-gallery-index-tsx":["/component---src-pages-gallery-index-tsx-0a570cc011ebe9b221fc.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-14d418d9f71cbfe772fb.js"],"component---src-pages-posts-mdx-slug-tsx":["/component---src-pages-posts-mdx-slug-tsx-db6a863d59075dfd4640.js"],"component---src-pages-tags-index-tsx":["/component---src-pages-tags-index-tsx-3d3d4d382476feb1beb8.js"]};/*]]>*/</script><script src="/polyfill-f012ba4a76c3d692158a.js" nomodule=""></script><script src="/app-9537a4856cd0b2a1dd44.js" async=""></script><script src="/framework-0ea894b592cd5d21d3c6.js" async=""></script><script src="/webpack-runtime-d32edc4e0e016ccc93cc.js" async=""></script></body></html>