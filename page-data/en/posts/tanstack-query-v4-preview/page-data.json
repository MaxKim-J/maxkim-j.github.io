{"componentChunkName":"component---src-pages-en-posts-mdx-frontmatter-slug-tsx","path":"/en/posts/tanstack-query-v4-preview/","result":{"data":{"post":{"id":"4d6db33d-86c2-5cab-b216-f61b0de0cdeb","slug":"tanstack-query-v4-preview-en","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"TanStack Query v4 - A Quick Look at What's Changed\",\n  \"description\": \"A look at React Query updated to v4\",\n  \"date\": \"2023-01-24T00:00:00.000Z\",\n  \"category\": \"tech\",\n  \"slug\": \"tanstack-query-v4-preview\",\n  \"tags\": [\"react\", \"javascript\"],\n  \"lang\": \"en\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Over a year ago, I wrote a post exploring React Query. Time passed, v4 came out, and the name changed to Tanstack Query.\"), mdx(\"p\", null, \"Here's a quick look at some of the major breaking changes based on the highlights from the official Tanstack Query documentation \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4\"\n  }, \"Migration to React Query 4\"), \". I'll be translating and paraphrasing from the docs and adding my own quirks.\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://pbs.twimg.com/media/FU0cvW9XsAEJxu3?format=jpg&name=medium\",\n    \"alt\": \"TQ4\"\n  })), mdx(\"h2\", {\n    \"id\": \"the-idle-state-has-been-removed\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#the-idle-state-has-been-removed\",\n    \"aria-label\": \"the idle state has been removed permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4\"\n  }, \"The Idle State has been removed\")), mdx(\"p\", null, \"In v4, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \", which was previously one of the return values of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useQuery\"), \", is split into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"fetchStatus\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \".\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"status\")), \": \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"data\"), \", indicates information about the query result.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"loading: No data yet\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"error: no data, but there is an error\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"success: there is data\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"fetchStatus\")), \": Indicates information about \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"queryFn\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"idle: the query is not doing anything\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"paused: The query is attempting to patch but has been paused. Associated with network mode\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"fetching: The state that the query is patching\")))), mdx(\"p\", null, \"Doakes notes that both background refetch and stale-while-validate behavior can be described by a combination of these two states.\"), mdx(\"p\", null, \"When there was only one \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \", there were situations where the wording was ambiguous, which is why \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \" was split. The quotes below are taken from Doakes, and the corresponding ambiguities.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"If the query is in success state, the fetchStatus should be idle, but it could be fetching because background patching is happening.\")), mdx(\"p\", null, \"In v3, we had to use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isFetching\"), \" value in background refetch situations because we could not \", \"[properly know]\", \" that patching was happening by evaluating whether \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \" was \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-query-v3.tanstack.com/guides/background-fetching-indicators#_top\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"loading\")), \". This was because \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \" was not a good representation of the state of the query.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"If there is no data since the query was mounted, it could be the case that the status is loading and the fetchStatus is fetching, but it could also be the case that it is paused, depending on the network connection.\")), mdx(\"p\", null, \"In v3, if the first request fails, refetch is paused when there is no network connection. The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \" remains \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"loading\"), \" \", \"[until the connection resumes]\", \".(\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://tkdodo.eu/blog/offline-react-query\"\n  }, \"https://tkdodo.eu/blog/offline-react-query\"), \") In this situation, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"status\"), \" does not indicate that the query is paused.\"), mdx(\"h2\", {\n    \"id\": \"queries-and-mutations-per-default-need-network-connection-to-run\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#queries-and-mutations-per-default-need-network-connection-to-run\",\n    \"aria-label\": \"queries and mutations per default need network connection to run permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#queries-and-mutations-per-default-need-network-connection-to-run\"\n  }, \"Queries and mutations, per default, need network connection to run\")), mdx(\"p\", null, \"In v4, we added the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"networkMode\"), \" option, a feature that provides explicit offline mode for queries and mutations.\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"networkMode:online\"), \" is provided by default in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"QueryClient\"), \" setting, which indicates that there is no network connection via the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"fetchStatus:paused\"), \" described above when the network is offline.\"), mdx(\"p\", null, \"If you want the behavior in v3, you can change the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"networkMode\"), \" setting to\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"new QueryClient({\\n  defaultOptions: {\\n    queries: {\\n      networkMode: 'offlineFirst',\\n    },\\n    mutations: {\\n      networkMode: 'offlineFirst',\\n    },\\n  },\\n});\"), \"\\n        \"), mdx(\"p\", null, \"There are three possible values for networkMode.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"online\")), \": No fetch is attempted while offline until a network connection is available, at which point the status of the query is marked as \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"fetchStatus:paused\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"always\")), \": Attempt to fetch while offline as if you were online. It will have a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"status:error\"), \" status because it's sending the request while offline.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"offlineFirst\")), \": Same as behavior in v3: stop retrying after the first call to queryFn.\")), mdx(\"p\", null, \"In the blog post by dox and tk-dodo, there's an interesting quadruple entendre when describing offline query.\"), mdx(\"blockquote\", null, mdx(\"blockquote\", {\n    parentName: \"blockquote\"\n  }, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Even though React Query is an Async State Manager that can be used for anything that produces a Promise, it is most often used for data fetching in combination with data fetching libraries. (\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#queries-and-mutations-per-default-need-network-connection-to-run\"\n  }, \"#\"), \")\"))), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"I've said it time and time again - React Query is an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://tkdodo.eu/blog/react-query-as-a-state-manager\"\n  }, \"async state manager\"), \". As long as you give it a Promise, resolved or rejected, the library is happy. Doesn't matter where that Promise comes from. (\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://tkdodo.eu/blog/offline-react-query\"\n  }, \"#\"), \")\")), mdx(\"p\", null, \"network mode is a use case that is only related to data fetching, so I thought I'd explain that providing an option like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"networkMode\"), \" doesn't really fit the concept of \\\"Async State Manager\\\" that Tanstack Query stands for...\"), mdx(\"h2\", {\n    \"id\": \"query-filters\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#query-filters\",\n    \"aria-label\": \"query filters permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#query-filters\"\n  }, \"Query Filters\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"active\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"inactive\"), \" options are consolidated into a single \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"type\"), \" that can be used with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"queryClient\"), \" to make bulk changes to queries that meet multiple conditions.\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"// Cancel all queries\\nawait queryClient.cancelQueries();\\n\\n// Remove all inactive queries that begin with `posts` in the key\\nqueryClient.removeQueries({ queryKey: ['posts'], type: 'inactive' });\\n\\n// Refetch all active queries\\nawait queryClient.refetchQueries({ type: 'active' });\\n\\n// Refetch all active queries that begin with `posts` in the key\\nawait queryClient.refetchQueries({ queryKey: ['posts'], type: 'active' });\"), \"\\n        \"), mdx(\"p\", null, \"Originally, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"active\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"inactive\"), \" options were mutually exclusive and sometimes didn't work well when both were set. Setting both to false would match all queries, which is not expected behavior.\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"type\"), \" attribute makes it easy to indicate whether the queries you're looking for are \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"active\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"inactive\"), \", or all queries.\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"diff\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"- active?: boolean\\n- inactive?: boolean\\n+ type?: 'active' | 'inactive' | 'all'\\n```diff active?\\n\\n## onSuccess is no logger called from setQueryData\\n\\nThe `onSuccess` callback is no longer called when `setQueryData` is called. The `onSuccess` callback is only called after an actual request has been made.\\n\\nWith the old behavior, `setQueryData` could be called inside `onSuccess`, which could cause an infinite loop. Even when coupled with `staleTime`, `onSuccess` was not called when data was fetched from cache, which could cause logic to behave in unexpected ways.\\n\\nDoakes also recommends using `useEffect` rather than `onSuccess` if you really want to subscribe to the data being changed: put the data in the `useEffect` dependency array.\\n\\n```tsx\\nconst { data } = useQuery({ queryKey, queryFn });\\nReact.useEffect(() => mySideEffectHere(data), [data]);\"), \"\\n        \"), mdx(\"p\", null, \"With \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://tkdodo.eu/blog/react-query-render-optimizations\"\n  }, \"structural sharing\"), \", the effect below is not called on every background fetch, but only when the data really changes.\"), mdx(\"h2\", {\n    \"id\": \"tracked-query-per-default\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#tracked-query-per-default\",\n    \"aria-label\": \"tracked query per default permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Tracked Query per default\"), mdx(\"p\", null, \"A very cool update, Tracked Query becomes the default behavior. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/TanStack/query/discussions/1554\"\n  }, \"Tracked Query\"), \" is an optimization that only re-renders the return value of a useQuery when the values it actually directly accesses change.\"), mdx(\"p\", null, \"This was originally achieved by using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"notifyOnChangeProps\"), \", one of the options in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useQuery\"), \", to manually specify which values to subscribe to.\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"// V3\\nfunction User() {\\n  const { data } = useQuery('user', fetchUser, {\\n    notifyOnChangeProps: ['data'], // only render when data changes\\n  });\\n  return <div>Username: {data.username}</div>;\\n}\"), \"\\n        \"), mdx(\"p\", null, \"Starting in v4, even without this processing, it will \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/TanStack/query/discussions/1554\"\n  }, \"proxy the query on its own\"), \", determine which values are being accessed by the component, and subscribe to those values.\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"// V4\\nfunction User() {\\n  // only render when data changes, even without notifyOnChangeProps\\n  const { data } = useQuery('user', fetchUser);\\n  return <div>Username: {data.username}</div>;\\n}\"), \"\\n        \"), mdx(\"p\", null, \"Now with the notifyOnChangeProps option, we don't need to pass an array of query return value names, we can just pass the 'all' value if we need to watch all the return values.\"), mdx(\"h2\", {\n    \"id\": \"etc\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#etc\",\n    \"aria-label\": \"etc permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"etc.\"), mdx(\"p\", null, \"I don't think this is important, but it's worth a look.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#bailing-out-of-updates-with-setquerydata\"\n  }, \"Bailing out of updates with setQueryData\"))), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"queryClient.setQueryData(['todo', id], (previousTodo) =>\\n  previousTodo ? { ...previousTodo, done: true } : undefined\\n);\"), \"\\n        \"), mdx(\"p\", null, \"When updating query data by passing a callback to setQueryData, if the callback returns undefined, the data will not be updated. This can be used when you need to update data conditionally, like in the example above.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#consistent-behavior-for-cancelrefetch\"\n  }, \"Consistent behavior for \", mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"cancelRefetch\")), \" : Provides optimization when updating query data imperatively.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#persistqueryclient-and-the-corresponding-persister-plugins-are-no-longer-experimental-and-have-been-renamed\"\n  }, \"PersistQueryClient and the corresponding persister plugins are no longer experimental and have been renamed\"), \": plugin to synchronize query data with external storage, no longer experimental.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#mutation-cache-garbage-collection\"\n  }, \"Mutation Cache Garbage Collection\"), \": Mutation can GC like Query and give a cacheTime, but I'm not sure how to keep the mutation cache and use it.\")), mdx(\"h2\", {\n    \"id\": \"interface-and-library-changes\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#interface-and-library-changes\",\n    \"aria-label\": \"interface and library changes permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Interface and library changes\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"With \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"queryKey\"), \" in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"useQuery\"), \", you can now only pass an array. \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#query-keys-and-mutation-keys-need-to-be-an-array\"\n  }, \"#\"))), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"diff\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"- useQuery('todos', fetchTodos)\\n+ useQuery(['todos'], fetchTodos)\"), \"\\n        \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"There is a change in behavior when passing multiple queries to \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"useQueries\"), \". \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#new-api-for-usequeries\"\n  }, \"#\"))), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"diff\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"- useQueries([{ queryKey1, queryFn1, options1 }, { queryKey2, queryFn2, options2 }])\\n+ useQueries({ queries: [{ queryKey1, queryFn1, options1 }, { queryKey2, queryFn2, options2 }] })\"), \"\\n        \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Prevent \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"queryFn\"), \" from returning \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"undefined\"), \", simultaneously at type and runtime level. \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#undefined-is-an-illegal-cache-value-for-successful-queries\"\n  }, \"#\"))), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\",\n    \"theme\": \"one-light\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"// \\u274C\\nuseQuery(['key'], () => axios.get(url).then((result) => console.log(result.data)));\"), \"\\n        \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Integrate the existing react-query/hydration package, which collects the APIs needed for SSR. \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#separate-hydration-exports-have-been-removed\"\n  }, \"#\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Support React18 as a first class. \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#support-for-react-18\"\n  }, \"#\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Support for both ESM and CJS via the exports field. \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#separate-hydration-exports-have-been-removed\"\n  }, \"#\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Supports codemod for easy migration. \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://tanstack.com/query/latest/docs/react/guides/migrating-to-react-query-4#codemod\"\n  }, \"#\"))), mdx(\"p\", null, \"(end)\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"TanStack Query v4 - A Quick Look at What's Changed","date":"2023년 01월 24일","description":"A look at React Query updated to v4","tags":["react","javascript"]}},"postSlugList":{"nodes":[{"frontmatter":{"slug":null}},{"frontmatter":{"slug":null}},{"frontmatter":{"slug":null}},{"frontmatter":{"slug":null}},{"frontmatter":{"slug":"how-to-growth"}},{"frontmatter":{"slug":"how-to-growth"}},{"frontmatter":{"slug":"olivia-rodrigo"}},{"frontmatter":{"slug":"olivia-rodrigo"}},{"frontmatter":{"slug":"2023-retorspect"}},{"frontmatter":{"slug":"2023-flexteam-restrospect"}},{"frontmatter":{"slug":"2023-flexteam-restrospect"}},{"frontmatter":{"slug":"2023-retorspect"}},{"frontmatter":{"slug":"tkdodo-react-query-commentary"}},{"frontmatter":{"slug":"tkdodo-react-query-commentary"}},{"frontmatter":{"slug":"on-stage-best"}},{"frontmatter":{"slug":"on-stage-best"}},{"frontmatter":{"slug":"nodejs-server-monitoring"}},{"frontmatter":{"slug":"nodejs-server-monitoring"}},{"frontmatter":{"slug":"i-can-do-this-all-day"}},{"frontmatter":{"slug":"i-can-do-this-all-day"}},{"frontmatter":{"slug":"retrospect-university"}},{"frontmatter":{"slug":"retrospect-university"}},{"frontmatter":{"slug":"module-federation-shared"}},{"frontmatter":{"slug":"module-federation-shared"}},{"frontmatter":{"slug":"tanjiro"}},{"frontmatter":{"slug":"tanjiro"}},{"frontmatter":{"slug":"module-federation-concepts"}},{"frontmatter":{"slug":"module-federation-concepts"}},{"frontmatter":{"slug":"eternal-sunshine"}},{"frontmatter":{"slug":"eternal-sunshine"}},{"frontmatter":{"slug":"business-driven"}},{"frontmatter":{"slug":"business-driven"}},{"frontmatter":{"slug":"uncertainty"}},{"frontmatter":{"slug":"uncertainty"}},{"frontmatter":{"slug":"runtime-integration-micro-frontends"}},{"frontmatter":{"slug":"runtime-integration-micro-frontends"}},{"frontmatter":{"slug":"tanstack-query-v4-preview"}},{"frontmatter":{"slug":"tanstack-query-v4-preview"}},{"frontmatter":{"slug":"writing-like-that"}},{"frontmatter":{"slug":"writing-like-that"}},{"frontmatter":{"slug":"2022-retorspect"}},{"frontmatter":{"slug":"2022-retorspect"}},{"frontmatter":{"slug":"monorepo-tooling"}},{"frontmatter":{"slug":"monorepo-tooling"}},{"frontmatter":{"slug":"break-up"}},{"frontmatter":{"slug":"break-up"}},{"frontmatter":{"slug":"sustainable-aimless"}},{"frontmatter":{"slug":"sustainable-aimless"}},{"frontmatter":{"slug":"job-searching-retrospect"}},{"frontmatter":{"slug":"job-searching-retrospect"}},{"frontmatter":{"slug":"2021-retorspect"}},{"frontmatter":{"slug":"2021-retorspect"}},{"frontmatter":{"slug":"web-accessiblity-virtuous-cycle"}},{"frontmatter":{"slug":"web-accessiblity-virtuous-cycle"}},{"frontmatter":{"slug":"frontend-tooling-ideas"}},{"frontmatter":{"slug":"frontend-tooling-ideas"}},{"frontmatter":{"slug":"suspense-argibraic-effect"}},{"frontmatter":{"slug":"suspense-argibraic-effect"}},{"frontmatter":{"slug":"packet-travel"}},{"frontmatter":{"slug":"packet-travel"}},{"frontmatter":{"slug":"dev-job-retrospect"}},{"frontmatter":{"slug":"dev-job-retrospect"}},{"frontmatter":{"slug":"redux-store-structure"}},{"frontmatter":{"slug":"redux-store-structure"}},{"frontmatter":{"slug":"react-native-ci-cd"}},{"frontmatter":{"slug":"react-native-ci-cd"}},{"frontmatter":{"slug":"like-legacy"}},{"frontmatter":{"slug":"like-legacy"}},{"frontmatter":{"slug":"what-type-of-developer-am-i"}},{"frontmatter":{"slug":"what-type-of-developer-am-i"}},{"frontmatter":{"slug":"how-to-minimize-redux-saga-typing"}},{"frontmatter":{"slug":"how-to-minimize-redux-saga-typing"}},{"frontmatter":{"slug":"how-to-use-redux-saga"}},{"frontmatter":{"slug":"how-to-use-redux-saga"}},{"frontmatter":{"slug":"github-actions-slack-bot"}},{"frontmatter":{"slug":"github-actions-slack-bot"}},{"frontmatter":{"slug":"frontend-infrastructure"}},{"frontmatter":{"slug":"frontend-infrastructure"}},{"frontmatter":{"slug":"react-query-preview"}},{"frontmatter":{"slug":"react-query-preview"}},{"frontmatter":{"slug":"keyboard-input"}},{"frontmatter":{"slug":"keyboard-input"}},{"frontmatter":{"slug":"precedent-bot-retrospect"}},{"frontmatter":{"slug":"precedent-bot-retrospect"}},{"frontmatter":{"slug":"nuxt-ssr"}},{"frontmatter":{"slug":"nuxt-ssr"}},{"frontmatter":{"slug":"async-console-log"}},{"frontmatter":{"slug":"async-console-log"}},{"frontmatter":{"slug":"thought-ts"}},{"frontmatter":{"slug":"thought-ts"}},{"frontmatter":{"slug":"dev-job-after-junior"}},{"frontmatter":{"slug":"dev-job-after-junior"}},{"frontmatter":{"slug":"protect-var-against-undefined"}},{"frontmatter":{"slug":"protect-var-against-undefined"}},{"frontmatter":{"slug":"school-personal-project"}},{"frontmatter":{"slug":"school-personal-project"}},{"frontmatter":{"slug":"vue-comp-test"}},{"frontmatter":{"slug":"vue-comp-test"}},{"frontmatter":{"slug":"dom-pos-scroll"}},{"frontmatter":{"slug":"dom-pos-scroll"}},{"frontmatter":{"slug":"2020-retorspect"}},{"frontmatter":{"slug":"2020-retorspect"}},{"frontmatter":{"slug":"function-props-vuejs"}},{"frontmatter":{"slug":"function-props-vuejs"}},{"frontmatter":{"slug":"cra-webpack-config"}},{"frontmatter":{"slug":"cra-webpack-config"}},{"frontmatter":{"slug":"react-component-this"}},{"frontmatter":{"slug":"react-component-this"}},{"frontmatter":{"slug":"git-start"}},{"frontmatter":{"slug":"git-start"}},{"frontmatter":{"slug":"js-pure-function"}},{"frontmatter":{"slug":"js-pure-function"}},{"frontmatter":{"slug":"hufs-semester-clock"}},{"frontmatter":{"slug":"hufs-semester-clock"}},{"frontmatter":{"slug":"js-map"}},{"frontmatter":{"slug":"js-map"}},{"frontmatter":{"slug":"why-dev"}},{"frontmatter":{"slug":"why-dev"}}]}},"pageContext":{"id":"cfefd69a-3a64-5d0e-a8ae-ac0715d80588","frontmatter__slug":"tanstack-query-v4-preview","__params":{"frontmatter__slug":"tanstack-query-v4-preview"}}},"staticQueryHashes":["1865044719"]}